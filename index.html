<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL 期末考模擬系統 // 科技版 v2.0</title>
    <style>
        /* --- 1. 核心科技風格設定 --- */
        :root {
            --bg-dark: #050a10;
            --panel-bg: rgba(16, 24, 39, 0.9); 
            --primary-cyan: #00f3ff;
            --neon-green: #39ff14;
            --alert-red: #ff073a;
            --text-main: #e0f2f1;
            --text-dim: #94a3b8;
            --accent-yellow: #f1c40f; /* 詳解提示色 */
        }

        body {
            font-family: "Microsoft JhengHei", "Segoe UI", "Roboto", monospace;
            background: radial-gradient(circle at center, #1a2c38 0%, #050a10 100%);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        body::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            z-index: -1;
        }

        .container {
            background: var(--panel-bg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 243, 255, 0.2);
            padding: 2.5rem;
            border-radius: 4px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.8), inset 0 0 20px rgba(0, 243, 255, 0.05);
            width: 100%;
            max-width: 800px;
            text-align: center;
            position: relative;
        }

        h1 {
            color: var(--primary-cyan);
            letter-spacing: 2px;
            text-shadow: 0 0 10px rgba(0, 243, 255, 0.6);
            margin-bottom: 2rem;
            font-size: 1.8rem;
        }

        /* --- 2. 按鈕與選項 --- */
        .btn {
            padding: 12px 24px;
            font-size: 1rem;
            border: 1px solid var(--primary-cyan);
            background: rgba(0, 243, 255, 0.1);
            color: var(--primary-cyan);
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 8px;
            font-family: inherit;
            font-weight: bold;
        }

        .btn:hover:not(:disabled) {
            background: var(--primary-cyan);
            color: #000;
            box-shadow: 0 0 20px var(--primary-cyan);
        }

        .btn-option {
            display: block; width: 100%; margin: 12px 0; padding: 15px; text-align: left;
            background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-dim);
        }

        .btn-option.correct { background: rgba(57, 255, 20, 0.2); border-color: var(--neon-green); color: var(--neon-green); }
        .btn-option.wrong { background: rgba(255, 7, 58, 0.2); border-color: var(--alert-red); color: var(--alert-red); }

        /* --- 3. 詳解區塊 --- */
        #explanation-box {
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 243, 255, 0.05);
            border-left: 4px solid var(--primary-cyan);
            text-align: left;
            line-height: 1.6;
            display: none; /* 預設隱藏 */
            animation: fadeIn 0.5s ease;
        }

        .exp-title { color: var(--primary-cyan); font-weight: bold; margin-bottom: 5px; display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- 4. 其他元件 --- */
        .status-bar { display: flex; justify-content: space-between; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); color: var(--primary-cyan); font-weight: bold; }
        .table-container { overflow-x: auto; margin: 20px 0; border: 1px solid rgba(0, 243, 255, 0.3); }
        .question-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        .question-table th, .question-table td { border: 1px solid rgba(255, 255, 255, 0.1); padding: 8px; text-align: left; }
        .question-table th { background: rgba(0, 243, 255, 0.2); }
        .hide { display: none; }
        .score-big { font-size: 4rem; color: var(--primary-cyan); text-shadow: 0 0 20px var(--primary-cyan); margin: 20px 0; }
        code { background: rgba(0,0,0,0.4); padding: 2px 5px; color: #ff79c6; border-radius: 3px; }
    </style>
</head>
<body>

<div class="container">
    <div id="start-screen">
        <h1>SQL 期末考模擬系統 <br><span style="font-size:0.6em; color:#fff;">// 系統就緒 SYSTEM READY</span></h1>
        <p style="color: var(--text-dim); margin-bottom: 30px;">請選擇測驗模式：</p>
        <button class="btn" onclick="startQuiz(10)">[ 10 題速測 ]</button>
        <button class="btn" onclick="startQuiz(25)">[ 25 題練習 ]</button>
        <button class="btn" onclick="startQuiz('all')">[ 完整題庫刷題 ]</button>
    </div>

    <div id="quiz-screen" class="hide">
        <div class="status-bar">
            <span id="progress-text">進度：0/0</span>
            <span id="score-text">得分：0</span>
        </div>
        
        <h3 id="question-text" style="text-align: left; line-height: 1.5;">載入中...</h3>
        
        <div id="table-display" class="table-container hide"></div>
        
        <div id="options-container"></div>

        <div id="explanation-box">
            <span class="exp-title"> <i class="icon"></i> 系統解析 // ANALYSIS:</span>
            <div id="explanation-content" style="color: #fff;"></div>
        </div>
        
        <button id="next-btn" class="btn" style="display:none; width:100%; background:var(--neon-green); color:#000; border:none;" onclick="nextQuestion()">確認 // 下一題 >></button>
    </div>

    <div id="result-screen" class="hide">
        <h1>測驗程序結束</h1>
        <div id="final-score" class="score-big">0</div>
        <p id="feedback-msg"></p>
        <button class="btn" onclick="location.reload()">[ 重新啟動系統 ]</button>
    </div>
</div>

<script>
    // --- 題目數據 (新增了 explanation 欄位) ---
// --- 1. 定義題目所需的 HTML 表格字串 (這部分你之前漏掉了) ---
const t_emp = `
<table class="question-table">
    <tr><th>資料行名稱</th><th>資料類型</th></tr>
    <tr><td>員工編號</td><td>int</td></tr>
    <tr><td>姓名</td><td>varchar(20)</td></tr>
    <tr><td>職稱</td><td>varchar(20)</td></tr>
    <tr><td>性別</td><td>varchar(2)</td></tr>
</table>`;

const t_car = `
<table class="question-table">
    <tr><th>Type</th><th>Color</th><th>Origin</th></tr>
    <tr><td>Sedan</td><td>Red</td><td>Japan</td></tr>
    <tr><td>Truck</td><td>Red</td><td>USA</td></tr>
    <tr><td>Minivan</td><td>Silver</td><td>Japan</td></tr>
    <tr><td>Hatchback</td><td>Red</td><td>Japan</td></tr>
    <tr><td>SUV</td><td>Silver</td><td>Germany</td></tr>
</table>`;

// --- 2. 完整題庫數據庫 ---
const questionBank = [
    // 1. DDL & 資料型態
    { 
        q: "如果想利用 SQL DDL 語法建立一個名稱為 Chihlee 的資料表，下列語法何者正確？", 
        options: ["CREATE TABLE Chihlee (...)", "ALTER DATABASE Chihlee (...)", "DROP DATABASE Chihlee (...)", "CREATE DATABASE Chihlee (...)"], 
        answer: 0,
        explanation: "<b>CREATE TABLE</b> 是資料定義語言 (DDL) 中用來建立新資料表的標準指令。CREATE DATABASE 則是用來建立整個資料庫空間。"
    },
    { 
        q: "若要在資料庫中新增一個欄位來儲存同學的姓名(可能有造字)，則應該將資料類型設定為何？", 
        options: ["char", "varchar", "nvarchar", "int"], 
        answer: 2,
        explanation: "<b>nvarchar</b> 中的 'n' 代表 Unicode 編碼，能夠支援多國語系及特殊造字；'varchar' 則主要支援一般英數字。"
    },
    { 
        q: "若要在資料庫中儲存同學的身分證號(如:A123456789)，何種類型較適合？", 
        options: ["char(10)", "int", "float", "datetime"], 
        answer: 0,
        explanation: "身分證字號長度固定為 10 碼且包含英文，使用定長字串 <b>char(10)</b> 效能最優且符合格式。"
    },
    { 
        q: "若要儲存電話號碼(如:02-22576167)，何種類型較適合？", 
        options: ["char", "int", "float", "datetime"], 
        answer: 0,
        explanation: "電話號碼包含連字號 '-'，屬於非數值運算的字元，應選用 <b>char</b> 或 varchar。"
    },
    { 
        q: "若要儲存出生年月日(如:1985-01-01)，何種類型較適合？", 
        options: ["char", "int", "float", "date"], 
        answer: 3,
        explanation: "<b>date</b> 類型專門儲存日期（不含時間），比字串格式更節省空間並支援日期運算。"
    },
    { 
        q: "若要儲存成績(如:90.50)，何種類型較適合？", 
        options: ["int", "tinyint", "money", "numeric"], 
        answer: 3,
        explanation: "<b>numeric</b> (或 decimal) 可精確定義總位數與小數位數，適合儲存有小數點的數值資料。"
    },
    { 
        q: "若要儲存學費(如:23,570)，且輸入時能以三位數逗號分隔輸入，何種類型較適合？", 
        options: ["int", "tinyint", "money", "numeric"], 
        answer: 2,
        explanation: "<b>money</b> 類型專門處理貨幣數據，支援財務格式化呈現與精確計算。"
    },
    { 
        q: "若數字資料範圍介於 -100 到 100 之間，選擇哪一種類型較適合？", 
        options: ["char", "int", "float", "datetime"], 
        answer: 1,
        explanation: "範圍包含負數且為整數，<b>int</b> (或 smallint) 是正確選擇；tinyint 僅支援 0~255。"
    },
    { 
        q: "若希望輸入資料行時系統可以有預設值，要在哪處設定？", 
        options: ["允許NULL", "長度", "資料類型", "預設值或繫結"], 
        answer: 3,
        explanation: "<b>預設值 (DEFAULT)</b> 屬性用於當 Insert 語法未指定該欄位值時，系統自動填入的值。"
    },
    { 
        q: "若預設值要設定為「輸入資料的當天日期」，應設定什麼？", 
        options: ["DATE()", "getday()", "getdate()", "getnow()"], 
        answer: 2,
        explanation: "在 SQL Server 中，<b>getdate()</b> 函數會回傳伺服器目前的系統日期與時間。"
    },

    // 2. 條件約束 & 進階 DDL
    { 
        q: "在建立關聯時，設定刪除規格為『沒有動作 (NO ACTION)』代表？", 
        options: ["沒有動作(NO ACTION)", "重疊顯示(CASCADE)", "設定為Null(SET NULL)", "設定為預設值(SET DEFAULT)"], 
        answer: 0,
        explanation: "<b>NO ACTION</b> 會在嘗試刪除被關聯的主鍵時拋出錯誤，阻止刪除動作以保護資料完整性。"
    },
    { 
        q: "希望刪除主表資料時，子表對應資料也一併刪除，應設定？", 
        options: ["沒有動作(NO ACTION)", "重疊顯示(CASCADE)", "設定為Null(SET NULL)", "設定為預設值(SET DEFAULT)"], 
        answer: 1,
        explanation: "<b>CASCADE (級聯/重疊)</b> 代表父表的變動會「像瀑布一樣」連帶影響到子表。"
    },
    { 
        q: "希望主鍵刪除時，子表對應欄位設為空值，應設定？", 
        options: ["沒有動作(NO ACTION)", "重疊顯示(CASCADE)", "設定為Null(SET NULL)", "設定為預設值(SET DEFAULT)"], 
        answer: 2,
        explanation: "<b>SET NULL</b> 會在父資料消失時，自動將關聯的外鍵欄位清除為 NULL。"
    },
    { 
        q: "關於計算欄位 (Computed Columns) 的敘述，下列何者錯誤？", 
        options: ["是一種沒有儲存值的資料表欄位", "值可由同記錄其他欄位運算而來", "它可以指定DEFAULT屬性", "它是一種虛擬欄位"], 
        answer: 2,
        explanation: "<b>錯誤。</b>計算欄位是根據公式自動生成的，因此<b>不能手動指定 DEFAULT 屬性</b>。"
    },
    { 
        q: "關於條件限制 (Constraints) 的敘述，下列何者錯誤？", 
        options: ["可以定義檢查規則", "若主索引鍵由多個欄位組成，可在行定義中描述", "單一欄位限制為行層級", "多欄位限制為表層級"], 
        answer: 1,
        explanation: "<b>錯誤。</b>若主鍵由多個欄位組成（複合主鍵），必須在資料表定義的最末端以「資料表層級」方式定義。"
    },
    { 
        q: "執行：<code>ALTER TABLE 借閱紀錄 DROP COLUMN 歸還日期, 逾期罰金</code> 結果為何？", 
        options: ["刪除歸還日期", "刪除逾期罰金", "一併刪除該兩欄位", "刪除整個資料表"], 
        answer: 2,
        explanation: "ALTER TABLE 配合 <b>DROP COLUMN</b> 並用逗號隔開多個欄位，可同時移除多個結構。"
    },
    { 
        q: "若執行 <code>ALTER TABLE Person ADD Prefix varchar(4) NOT NULL;</code> 出錯，原因可能為？", 
        options: ["應使用DEFAULT設定值", "Person表是空的", "varchar不適用", "應先執行DROP"], 
        answer: 0,
        explanation: "若表格已有舊資料，新增一個 <b>NOT NULL</b> 欄位會因舊資料無值而失敗，此時必須提供 <b>DEFAULT</b> 預設值。"
    },

    // 3. SQL 函數
    { 
        q: "執行 SQL：<code>SELECT ROUND(78.94, -1)</code> 結果為何？", 
        options: ["78.94", "78.95", "79.00", "80.00"], 
        answer: 3,
        explanation: "ROUND 參數為 -1 代表<b>四捨五入到十位數</b>。78 四捨五入後為 80。"
    },
    { 
        q: "執行 SQL：<code>SELECT CEILING(89.3)</code> 結果為何？", 
        options: ["89.3", "89.4", "89.0", "90.0"], 
        answer: 3,
        explanation: "<b>CEILING</b> (天花板函數) 會回傳大於或等於該數值的最小整數（無條件進位）。"
    },
    { 
        q: "執行 SQL：<code>SELECT SQRT(25)</code> 結果為何？", 
        options: ["0", "5", "25", "625"], 
        answer: 1,
        explanation: "<b>SQRT</b> 是求平方根。25 的平方根為 5。"
    },
    { 
        q: "執行 SQL：<code>SELECT SQUARE(4)</code> 結果為何？", 
        options: ["0", "2", "4", "16"], 
        answer: 3,
        explanation: "<b>SQUARE</b> 是求平方。4 的平方 (4*4) 為 16。"
    },
    { 
        q: "執行 SQL：<code>SELECT CAST('123' AS INT)</code> 的轉換函數是？", 
        options: ["CAST", "SORT", "ROUND", "ABS"], 
        answer: 0,
        explanation: "<b>CAST</b> 與 CONVERT 都是 SQL 中用於進行資料型態轉換的標準函數。"
    },
    { 
        q: "執行 SQL：<code>SELECT DATEPART(month, '2019-3-20')</code> 結果為何？", 
        options: ["2019", "1", "3", "20"], 
        answer: 2,
        explanation: "<b>DATEPART(month, ...)</b> 會擷取日期中的月份部分。結果為 3。"
    },
    { 
        q: "執行 SQL：<code>SELECT DATEADD(month, 1, '2018-01-31')</code> 結果為何？", 
        options: ["2019-01-31", "2018-02-28", "2018-04-30", "2017-10-31"], 
        answer: 1,
        explanation: "1月31日加一個月應為2月，但2月沒有31日，系統會自動校正為該月最後一天 <b>02-28</b>。"
    },
    { 
        q: "執行 SQL：<code>SELECT DATEDIFF(yy, '2019/12/05', '2017/01/01')</code> 結果為何？", 
        options: ["1", "-2", "16", "19"], 
        answer: 1,
        explanation: "DATEDIFF 會用後者減去前者。2017 - 2019 = <b>-2</b>。"
    },
    { 
        q: "執行 SQL：<code>SELECT LEN('chihlee')</code> 結果為何？", 
        options: ["6", "7", "8", "9"], 
        answer: 1,
        explanation: "<b>LEN</b> 函數計算字串中的字元數量。'chihlee' 共 7 個字母。"
    },
    { 
        q: "執行 SQL：<code>SELECT CHARINDEX('致理','致理科技大學:致理人', 4)</code> 結果為何？", 
        options: ["0", "1", "8", "14"], 
        answer: 2,
        explanation: "從第 4 個字開始找，找到的第二個 '致理' 出現在第 <b>8</b> 個位置。"
    },
    { 
        q: "執行 SQL：<code>SELECT LEFT('CHIHLEE', 3)</code> 結果為何？", 
        options: ["CHI", "HLE", "LEE", "CHIHLEE"], 
        answer: 0,
        explanation: "<b>LEFT(str, 3)</b> 會從左側開始擷取 3 個字元。結果為 CHI。"
    },

    // 4. SELECT 查詢 & 邏輯
    { 
        q: "想要顯示 [員工] 資料表的所有內容，語法何者正確？", 
        table: t_emp,
        options: ["SELECT 員工編號 FROM 員工", "SELECT * FROM 員工", "SELECT FROM 員工", "SHOW 員工"], 
        answer: 1,
        explanation: "星號 <b>*</b> 在 SQL 中代表「所有資料行」。"
    },
    { 
        q: "若要依 [員工編號] 遞減排序，語法應加上？", 
        table: t_emp,
        options: ["ORDER BY 員工編號", "ORDER BY 員工編號 ASC", "SORT BY 員工編號", "ORDER BY 員工編號 DESC"], 
        answer: 3,
        explanation: "排序使用 ORDER BY，遞減需指定 <b>DESC</b>；ASC 則是預設的遞增排序。"
    },
    { 
        q: "SQL 語法中，哪個關鍵字可避免查詢結果重複？", 
        options: ["ONLY", "UNIQUE", "NOT SAME", "DISTINCT"], 
        answer: 3,
        explanation: "<b>DISTINCT</b> 會過濾掉結果集中完全重複的資料列。"
    },
    { 
        q: "針對「群組化後」的結果進行條件篩選，要使用哪個子句？", 
        options: ["WHERE", "ORDER BY", "HAVING", "GROUP BY"], 
        answer: 2,
        explanation: "WHERE 是篩選原始資料，<b>HAVING</b> 則是專門用來篩選 GROUP BY 之後的群組資料。"
    },
    { 
        q: "有一個 Cars 表，執行 <code>SELECT * FROM Cars WHERE Origin <> 'USA' AND Color <> 'Black'</code> 回傳幾筆？", 
        table: t_car,
        options: ["4", "5", "6", "7"], 
        answer: 0,
        explanation: "符合條件：Sedan(Japan,Red), Minivan(Japan,Silver), Hatchback(Japan,Red), SUV(Germany,Silver)。共 <b>4</b> 筆。"
    },
    { 
        q: "如何移除一個已經建立的「外部索引鍵 (Foreign Key)」？", 
        options: ["DELETE TABLE", "DELETE FOREIGN KEY", "ALTER FOREIGN KEY", "ALTER TABLE"], 
        answer: 3,
        explanation: "約束（Constraint）是資料表結構的一部分，必須透過 <b>ALTER TABLE [表名] DROP CONSTRAINT [約束名]</b> 來移除。"
    }
];

// --- 3. 系統邏輯控制 ---
let currentQuestions = [];
let currentQuestionIndex = 0;
let score = 0;
let isAnswered = false;

// 這裡之後接續你原本的 startQuiz, loadQuestion, checkAnswer 等函式...
const quizScreen = document.getElementById('quiz-screen');
const questionText = document.getElementById('question-text');
const optionsContainer = document.getElementById('options-container');
const expBox = document.getElementById('explanation-box');
const expContent = document.getElementById('explanation-content');
const nextBtn = document.getElementById('next-btn');

function startQuiz(amount) {
    const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
    currentQuestions = (amount === 'all') ? shuffled : shuffled.slice(0, amount);
    
    currentQuestionIndex = 0; score = 0;
    document.getElementById('start-screen').classList.add('hide');
    quizScreen.classList.remove('hide');
    loadQuestion();
}

function loadQuestion() {
    isAnswered = false;
    expBox.style.display = 'none';
    nextBtn.style.display = 'none';
    
    const q = currentQuestions[currentQuestionIndex];
    document.getElementById('progress-text').innerText = `進度：${currentQuestionIndex + 1} / ${currentQuestions.length}`;
    document.getElementById('score-text').innerText = `得分：${Math.round((score/currentQuestions.length)*100) || 0} %`;
    
    questionText.innerHTML = q.q;

    const tableDisplay = document.getElementById('table-display');
    if (q.table) {
        tableDisplay.innerHTML = q.table;
        tableDisplay.classList.remove('hide');
    } else {
        tableDisplay.classList.add('hide');
    }

    optionsContainer.innerHTML = '';
    q.options.forEach((opt, index) => {
        const btn = document.createElement('button');
        btn.innerHTML = `<span style="opacity:0.5; margin-right:10px;">[ ${String.fromCharCode(65+index)} ]</span> ${opt}`;
        btn.classList.add('btn', 'btn-option');
        btn.onclick = () => checkAnswer(index, btn);
        optionsContainer.appendChild(btn);
    });
}

function checkAnswer(selectedIndex, selectedBtn) {
    if (isAnswered) return;
    isAnswered = true;

    const q = currentQuestions[currentQuestionIndex];
    const correctIndex = q.answer;
    const allBtns = optionsContainer.children;

    if (selectedIndex === correctIndex) {
        score++;
        selectedBtn.classList.add('correct');
    } else {
        selectedBtn.classList.add('wrong');
        allBtns[correctIndex].classList.add('correct');
    }

    expContent.innerHTML = q.explanation || "該題暫無詳細解析。";
    expBox.style.display = 'block';

    for (let btn of allBtns) { btn.disabled = true; }
    nextBtn.style.display = 'block';
}

function nextQuestion() {
    currentQuestionIndex++;
    if (currentQuestionIndex < currentQuestions.length) {
        loadQuestion();
    } else {
        showResults();
    }
}

function showResults() {
    quizScreen.classList.add('hide');
    document.getElementById('result-screen').classList.remove('hide');
    const percentage = Math.round((score / currentQuestions.length) * 100);
    document.getElementById('final-score').innerText = percentage + "%";
    document.getElementById('feedback-msg').innerText = percentage >= 60 ? "任務成功 // 通過認證" : "任務失敗 // 權限不足";
}
</script>

</body>
</html>
